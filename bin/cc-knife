#!/usr/bin/env ruby
require 'cucumber-chef'

# if we have bundler binstubs use that; otherwise attempt to detect
knife = (Cucumber::Chef.locate(:file, "bin", "knife") rescue nil)
knife = "/usr/bin/env knife" unless knife

knife_rb = Cucumber::Chef.locate(:file, ".cucumber-chef", "knife.rb")
if File.exists?(knife_rb)
  command = [knife, ARGV, "-c #{knife_rb}", "2>&1"].flatten.compact.join(" ")
  puts(command)
  puts(%x(#{command}))
  exit($?)
else
  puts("Could not find your Cucumber-Chef 'knife.rb'.  Did you setup your test lab?")
  exit(255)
end
